#!/bin/bash
set -e

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "Running pre-commit checks..."

# Check for type ignores and linter ignores
PYTHON_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.py$' || true)
if [ -n "$PYTHON_FILES" ]; then
    echo ""
    echo "Checking for type ignores and linter ignores in staged files..."

    IGNORES_FOUND=0

    for file in $PYTHON_FILES; do
        if git show ":$file" | grep -qE '# type:? ?ignore|# noqa|# ruff:? ?ignore|# pylint:? ?ignore' 2>/dev/null; then
            echo "${YELLOW}Found type/linter ignore in $file${NC}"
            git show ":$file" | grep -nE '# type:? ?ignore|# noqa|# ruff:? ?ignore|# pylint:? ?ignore' | sed 's/^/  /'
            IGNORES_FOUND=1
        fi
    done

    if [ $IGNORES_FOUND -eq 1 ]; then
        echo ""
        echo "${RED}ERROR: Type or linter ignores found in staged files.${NC}"
        echo "${RED}Please review CONTRIBUTING.md and remove these ignores before committing.${NC}"
        exit 1
    fi
fi

# Run the shared lint script
bash scripts/lint.sh

